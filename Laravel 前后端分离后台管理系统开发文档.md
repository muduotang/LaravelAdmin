# 前后端分离后台管理系统开发文档

## 一、项目概述

### 1.1 项目背景
本项目是一个基于 Laravel 10 和 Vue.js 的前后端分离后台管理系统，旨在为企业提供一套完整的权限管理解决方案。系统采用现代化的技术栈，具备良好的扩展性和维护性，支持多角色、多用户的细粒度权限控制。

### 1.2 技术栈选择
- **后端框架**：Laravel 10（PHP 8.1+）
  - 选择理由：成熟稳定的 PHP 框架，丰富的生态系统，优秀的 ORM 和中间件支持
- **前端框架**：Vue 2 + Element UI + vue-element-admin
  - 选择理由：渐进式框架，组件化开发，丰富的 UI 组件库
- **数据库**：MySQL 8.0+
  - 选择理由：稳定可靠，性能优秀，社区支持完善
- **缓存**：Redis 6.0+
  - 选择理由：高性能内存数据库，支持多种数据结构
- **文档规范**：OpenAPI 3.0
  - 选择理由：行业标准，工具支持完善，便于前后端协作

### 1.3 项目目标
- 实现完整的 RBAC 权限管理体系
- 提供友好的用户界面和交互体验
- 支持系统扩展和定制化需求
- 确保系统安全性和稳定性
- 提供完善的开发文档和 API 文档

---

## 二、系统架构设计

### 2.1 整体架构图
```
┌─────────────────────────────────────────────────────────────┐
│                        前端层 (Frontend)                      │
├─────────────────────────────────────────────────────────────┤
│  Vue.js + Element UI + vue-element-admin                    │
│  ├── 用户界面 (UI Layer)                                    │
│  ├── 状态管理 (Vuex)                                        │
│  ├── 路由管理 (Vue Router)                                  │
│  └── 权限控制 (Permission)                                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              │ HTTP/HTTPS
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        网关层 (Gateway)                       │
├─────────────────────────────────────────────────────────────┤
│  Nginx + SSL + CORS + Rate Limiting                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        后端层 (Backend)                       │
├─────────────────────────────────────────────────────────────┤
│  Laravel 10 + JWT + Middleware                             │
│  ├── 控制器层 (Controllers)                                 │
│  ├── 服务层 (Services)                                      │
│  ├── 仓储层 (Repositories)                                  │
│  ├── 模型层 (Models)                                        │
│  └── 中间件层 (Middleware)                                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                        数据层 (Data Layer)                    │
├─────────────────────────────────────────────────────────────┤
│  MySQL (主数据库) + Redis (缓存) + File Storage (文件存储)    │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 分层架构设计

#### 2.2.1 后端分层架构
```
┌─────────────────────────────────────────────────────────────┐
│                    表现层 (Presentation Layer)                │
├─────────────────────────────────────────────────────────────┤
│  Controllers (控制器)                                        │
│  ├── 请求接收和参数验证                                      │
│  ├── 调用服务层处理业务逻辑                                  │
│  ├── 返回统一格式的响应                                      │
│  └── OpenAPI 注解文档                                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    业务层 (Business Layer)                    │
├─────────────────────────────────────────────────────────────┤
│  Services (服务层)                                           │
│  ├── 业务逻辑处理                                            │
│  ├── 数据验证和业务规则                                      │
│  ├── 事务管理                                                │
│  └── 调用仓储层进行数据操作                                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据访问层 (Data Access Layer)             │
├─────────────────────────────────────────────────────────────┤
│  Repositories (仓储层)                                       │
│  ├── 数据访问逻辑封装                                        │
│  ├── 查询条件构建                                            │
│  ├── 缓存策略实现                                            │
│  └── 数据库操作抽象                                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据层 (Data Layer)                        │
├─────────────────────────────────────────────────────────────┤
│  Models (模型层)                                             │
│  ├── 数据结构和关系定义                                      │
│  ├── 查询作用域                                              │
│  ├── 数据转换和格式化                                        │
│  └── 基础的数据操作方法                                      │
└─────────────────────────────────────────────────────────────┘
```

#### 2.2.2 前端分层架构
```
┌─────────────────────────────────────────────────────────────┐
│                    视图层 (View Layer)                        │
├─────────────────────────────────────────────────────────────┤
│  Vue Components (Vue 组件)                                   │
│  ├── 页面组件 (Pages)                                        │
│  ├── 布局组件 (Layout)                                       │
│  ├── 通用组件 (Common)                                       │
│  └── 业务组件 (Business)                                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    状态管理层 (State Management)              │
├─────────────────────────────────────────────────────────────┤
│  Vuex Store (状态管理)                                       │
│  ├── 用户状态 (User State)                                   │
│  ├── 权限状态 (Permission State)                            │
│  ├── 应用状态 (App State)                                    │
│  └── 缓存状态 (Cache State)                                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    服务层 (Service Layer)                     │
├─────────────────────────────────────────────────────────────┤
│  API Services (API 服务)                                     │
│  ├── HTTP 请求封装                                           │
│  ├── 请求拦截器                                              │
│  ├── 响应拦截器                                              │
│  └── 错误处理                                                │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    工具层 (Utility Layer)                     │
├─────────────────────────────────────────────────────────────┤
│  Utils (工具函数)                                            │
│  ├── 权限验证工具                                            │
│  ├── 数据格式化工具                                          │
│  ├── 验证工具                                                │
│  └── 通用工具函数                                            │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 目录结构设计

#### 2.3.1 后端目录结构
```
backend/
├── app/                          # 应用核心目录
│   ├── Console/                  # 命令行命令
│   │   └── Commands/             # 自定义命令
│   ├── Exceptions/               # 异常处理
│   │   ├── Handler.php           # 异常处理器
│   │   └── ApiException.php      # API 异常类
│   ├── Http/                     # HTTP 相关
│   │   ├── Controllers/          # 控制器
│   │   │   ├── Api/              # API 控制器
│   │   │   │   ├── AuthController.php
│   │   │   │   ├── AdminController.php
│   │   │   │   ├── RoleController.php
│   │   │   │   ├── MenuController.php
│   │   │   │   ├── ResourceController.php
│   │   │   │   └── OperationLogController.php
│   │   │   └── WebController.php
│   │   ├── Middleware/           # 中间件
│   │   │   ├── ApiAuth.php       # API 认证中间件
│   │   │   ├── PermissionCheck.php # 权限校验中间件
│   │   │   ├── OperationLog.php  # 操作日志中间件
│   │   │   └── Cors.php          # 跨域中间件
│   │   ├── Requests/             # 表单请求验证
│   │   │   ├── LoginRequest.php
│   │   │   ├── AdminRequest.php
│   │   │   ├── RoleRequest.php
│   │   │   └── MenuRequest.php
│   │   └── Resources/            # API 资源
│   │       ├── AdminResource.php
│   │       ├── RoleResource.php
│   │       └── MenuResource.php
│   ├── Models/                   # 数据模型
│   │   ├── Admin.php
│   │   ├── Role.php
│   │   ├── Menu.php
│   │   ├── Resource.php
│   │   ├── ResourceCategory.php
│   │   └── OperationLog.php
│   ├── Providers/                # 服务提供者
│   │   ├── AppServiceProvider.php
│   │   ├── AuthServiceProvider.php
│   │   └── RepositoryServiceProvider.php
│   ├── Repositories/             # 仓储层
│   │   ├── Contracts/            # 仓储接口
│   │   │   ├── AdminRepositoryInterface.php
│   │   │   ├── RoleRepositoryInterface.php
│   │   │   └── MenuRepositoryInterface.php
│   │   ├── AdminRepository.php
│   │   ├── RoleRepository.php
│   │   ├── MenuRepository.php
│   │   ├── ResourceRepository.php
│   │   └── OperationLogRepository.php
│   ├── Services/                 # 服务层
│   │   ├── AuthService.php
│   │   ├── AdminService.php
│   │   ├── RoleService.php
│   │   ├── MenuService.php
│   │   ├── ResourceService.php
│   │   └── OperationLogService.php
│   ├── Traits/                   # 特征类
│   │   ├── ApiResponse.php       # API 响应格式化
│   │   └── HasRoles.php          # 角色关联特征
│   └── Helpers/                  # 辅助函数
│       ├── PermissionHelper.php
│       └── CommonHelper.php
├── config/                       # 配置文件
│   ├── app.php                   # 应用配置
│   ├── auth.php                  # 认证配置
│   ├── cors.php                  # 跨域配置
│   ├── jwt.php                   # JWT 配置
│   ├── l5-swagger.php            # OpenAPI 配置
│   ├── cache.php                 # 缓存配置
│   └── database.php              # 数据库配置
├── database/                     # 数据库相关
│   ├── factories/                # 模型工厂
│   │   ├── AdminFactory.php
│   │   ├── RoleFactory.php
│   │   └── MenuFactory.php
│   ├── migrations/               # 数据库迁移
│   │   ├── 2024_01_01_000001_create_admins_table.php
│   │   ├── 2024_01_01_000002_create_roles_table.php
│   │   ├── 2024_01_01_000003_create_menus_table.php
│   │   ├── 2024_01_01_000004_create_resources_table.php
│   │   ├── 2024_01_01_000005_create_resource_categories_table.php
│   │   ├── 2024_01_01_000006_create_operation_logs_table.php
│   │   └── 2024_01_01_000007_create_pivot_tables.php
│   └── seeders/                  # 数据填充
│       ├── DatabaseSeeder.php
│       ├── AdminSeeder.php
│       ├── RoleSeeder.php
│       └── MenuSeeder.php
├── routes/                       # 路由定义
│   ├── api.php                   # API 路由
│   ├── web.php                   # Web 路由
│   └── channels.php              # 广播路由
├── storage/                      # 存储目录
│   ├── app/                      # 应用存储
│   ├── framework/                # 框架存储
│   └── logs/                     # 日志文件
├── tests/                        # 测试文件
│   ├── Feature/                  # 功能测试
│   │   ├── AuthTest.php
│   │   ├── AdminTest.php
│   │   └── RoleTest.php
│   ├── Unit/                     # 单元测试
│   │   ├── Services/             # 服务测试
│   │   └── Repositories/         # 仓储测试
│   └── TestCase.php              # 测试基类
├── .env                          # 环境变量
├── .env.example                  # 环境变量示例
├── .gitignore                    # Git 忽略文件
├── composer.json                 # Composer 配置
├── artisan                       # Artisan 命令
└── README.md                     # 项目说明
```

#### 2.3.2 前端目录结构
```
frontend/
├── public/                       # 静态资源
│   ├── favicon.ico              # 网站图标
│   ├── index.html               # HTML 模板
│   ├── api-docs.json            # OpenAPI 文档
│   └── static/                  # 静态文件
│       ├── images/              # 图片资源
│       └── icons/               # 图标资源
├── src/                         # 源代码
│   ├── api/                     # API 接口
│   │   ├── auth.js              # 认证相关接口
│   │   ├── admin.js             # 用户管理接口
│   │   ├── role.js              # 角色管理接口
│   │   ├── menu.js              # 菜单管理接口
│   │   ├── resource.js          # 资源管理接口
│   │   ├── operation-log.js     # 操作日志接口
│   │   └── index.js             # API 统一导出
│   ├── assets/                  # 资源文件
│   │   ├── images/              # 图片
│   │   ├── icons/               # 图标
│   │   └── styles/              # 样式
│   ├── components/              # 公共组件
│   │   ├── Breadcrumb/          # 面包屑导航
│   │   │   ├── index.vue
│   │   │   └── index.js
│   │   ├── Hamburger/           # 折叠按钮
│   │   │   └── index.vue
│   │   ├── SvgIcon/             # SVG 图标
│   │   │   ├── index.vue
│   │   │   └── svg/
│   │   ├── Pagination/          # 分页组件
│   │   │   └── index.vue
│   │   ├── TreeTable/           # 树形表格
│   │   │   └── index.vue
│   │   └── common/              # 通用组件
│   │       ├── SearchForm.vue   # 搜索表单
│   │       ├── ActionButtons.vue # 操作按钮
│   │       └── StatusTag.vue    # 状态标签
│   ├── directive/               # 自定义指令
│   │   ├── permission/          # 权限指令
│   │   │   ├── index.js
│   │   │   └── permission.js
│   │   └── index.js             # 指令统一导出
│   ├── filters/                 # 过滤器
│   │   ├── index.js             # 过滤器统一导出
│   │   └── common.js            # 通用过滤器
│   ├── icons/                   # 图标
│   │   ├── svg/                 # SVG 图标文件
│   │   └── index.js             # 图标统一导出
│   ├── layout/                  # 布局组件
│   │   ├── components/          # 布局子组件
│   │   │   ├── Navbar.vue       # 顶部导航栏
│   │   │   ├── Sidebar/         # 侧边栏
│   │   │   │   ├── index.vue
│   │   │   │   ├── SidebarItem.vue
│   │   │   │   └── SidebarLogo.vue
│   │   │   ├── TagsView/        # 标签栏导航
│   │   │   │   ├── index.vue
│   │   │   │   └── components/
│   │   │   │       ├── ScrollPane.vue
│   │   │   │       └── ContextMenu.vue
│   │   │   ├── AppMain.vue      # 主内容区
│   │   │   └── Footer.vue       # 底部版权信息
│   │   └── index.vue            # 主布局
│   ├── router/                  # 路由配置
│   │   ├── index.js             # 路由主文件
│   │   └── modules/             # 路由模块
│   │       ├── admin.js         # 用户管理路由
│   │       ├── role.js          # 角色管理路由
│   │       ├── menu.js          # 菜单管理路由
│   │       └── system.js        # 系统管理路由
│   ├── store/                   # Vuex 状态管理
│   │   ├── index.js             # Store 主文件
│   │   └── modules/             # Store 模块
│   │       ├── app.js           # 应用状态
│   │       ├── user.js          # 用户状态
│   │       ├── permission.js    # 权限状态
│   │       └── tagsView.js      # 标签页状态
│   ├── styles/                  # 样式文件
│   │   ├── index.scss           # 主样式文件
│   │   ├── variables.scss       # 变量定义
│   │   ├── transition.scss      # 过渡动画
│   │   ├── element-ui.scss      # Element UI 样式覆盖
│   │   └── sidebar.scss         # 侧边栏样式
│   ├── utils/                   # 工具函数
│   │   ├── auth.js              # 认证相关工具
│   │   ├── request.js           # HTTP 请求封装
│   │   ├── validate.js          # 验证工具
│   │   ├── permission.js        # 权限工具
│   │   ├── common.js            # 通用工具
│   │   └── index.js             # 工具统一导出
│   ├── views/                   # 页面组件
│   │   ├── login/               # 登录页
│   │   │   ├── index.vue
│   │   │   └── components/
│   │   │       └── LoginForm.vue
│   │   ├── dashboard/           # 仪表盘
│   │   │   ├── index.vue
│   │   │   └── components/
│   │   │       ├── StatisticCard.vue
│   │   │       └── ChartPanel.vue
│   │   ├── admin/               # 用户管理
│   │   │   ├── index.vue
│   │   │   └── components/
│   │   │       ├── AdminForm.vue
│   │   │       └── RoleAssign.vue
│   │   ├── role/                # 角色管理
│   │   │   ├── index.vue
│   │   │   └── components/
│   │   │       ├── RoleForm.vue
│   │   │       └── PermissionAssign.vue
│   │   ├── menu/                # 菜单管理
│   │   │   ├── index.vue
│   │   │   └── components/
│   │   │       ├── MenuForm.vue
│   │   │       └── MenuTree.vue
│   │   ├── resource/            # 资源管理
│   │   │   ├── index.vue
│   │   │   └── components/
│   │   │       ├── ResourceForm.vue
│   │   │       └── CategorySelect.vue
│   │   ├── operation-log/       # 操作日志
│   │   │   ├── index.vue
│   │   │   └── components/
│   │   │       ├── LogFilter.vue
│   │   │       └── LogDetail.vue
│   │   ├── profile/             # 个人中心
│   │   │   ├── index.vue
│   │   │   └── components/
│   │   │       ├── ProfileForm.vue
│   │   │       └── PasswordForm.vue
│   │   ├── api-docs/            # API 文档
│   │   │   └── index.vue
│   │   └── error-page/          # 错误页面
│   │       ├── 404.vue
│   │       └── 403.vue
│   ├── permission.js            # 权限控制
│   ├── main.js                  # 入口文件
│   └── App.vue                  # 根组件
├── .env.development             # 开发环境配置
├── .env.production              # 生产环境配置
├── .env.staging                 # 测试环境配置
├── .eslintrc.js                 # ESLint 配置
├── .prettierrc                  # Prettier 配置
├── babel.config.js              # Babel 配置
├── vue.config.js                # Vue CLI 配置
├── package.json                 # 依赖配置
└── README.md                    # 项目说明
```

---

## 三、数据库设计

### 3.1 数据库架构图
```
┌─────────────────────────────────────────────────────────────┐
│                        数据库设计                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   admins    │    │    roles    │    │    menus    │     │
│  │             │    │             │    │             │     │
│  │ id (PK)     │    │ id (PK)     │    │ id (PK)     │     │
│  │ username    │    │ name        │    │ parent_id   │     │
│  │ password    │    │ description │    │ title       │     │
│  │ nick_name   │    │ status      │    │ name        │     │
│  │ email       │    │ sort        │    │ icon        │     │
│  │ status      │    │ created_at  │    │ level       │     │
│  │ created_at  │    │ updated_at  │    │ sort        │     │
│  │ updated_at  │    └─────────────┘    │ hidden      │     │
│  └─────────────┘                       │ keep_alive  │     │
│         │                              │ created_at  │     │
│         │                              │ updated_at  │     │
│         │                              └─────────────┘     │
│         │                                       │          │
│         │                              ┌─────────────┐     │
│         │                              │ role_menu   │     │
│         │                              │             │     │
│         │                              │ id (PK)     │     │
│         │                              │ role_id     │     │
│         │                              │ menu_id     │     │
│         │                              │ created_at  │     │
│         │                              │ updated_at  │     │
│         │                              └─────────────┘     │
│         │                                       │          │
│         │                              ┌─────────────┐     │
│         │                              │ resources   │     │
│         │                              │             │     │
│         │                              │ id (PK)     │     │
│         │                              │ category_id │     │
│         │                              │ name        │     │
│         │                              │ route_name  │     │
│         │                              │ description │     │
│         │                              │ created_at  │     │
│         │                              │ updated_at  │     │
│         │                              └─────────────┘     │
│         │                                       │          │
│         │                              ┌─────────────┐     │
│         │                              │role_resource│     │
│         │                              │             │     │
│         │                              │ id (PK)     │     │
│         │                              │ role_id     │     │
│         │                              │ resource_id │     │
│         │                              │ created_at  │     │
│         │                              │ updated_at  │     │
│         │                              └─────────────┘     │
│         │                                       │          │
│         │                              ┌─────────────┐     │
│         │                              │resource_cat │     │
│         │                              │             │     │
│         │                              │ id (PK)     │     │
│         │                              │ name        │     │
│         │                              │ sort        │     │
│         │                              │ created_at  │     │
│         │                              │ updated_at  │     │
│         │                              └─────────────┘     │
│         │                                       │          │
│         │                              ┌─────────────┐     │
│         │                              │admin_role   │     │
│         │                              │             │     │
│         │                              │ id (PK)     │     │
│         │                              │ admin_id    │     │
│         │                              │ role_id     │     │
│         │                              │ created_at  │     │
│         │                              │ updated_at  │     │
│         │                              └─────────────┘     │
│         │                                       │          │
│         │                              ┌─────────────┐     │
│         │                              │operation_log│     │
│         │                              │             │     │
│         │                              │ id (PK)     │     │
│         │                              │ admin_id    │     │
│         │                              │ operation   │     │
│         │                              │ detail      │     │
│         │                              │ ip          │     │
│         │                              │ address     │     │
│         │                              │ user_agent  │     │
│         │                              │ created_at  │     │
│         │                              │ updated_at  │     │
│         │                              └─────────────┘     │
│         │                                                 │
│         └─────────────────────────────────────────────────┘
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 表结构详细设计

#### 3.2.1 用户表（admins）
存储后台用户的基本信息，是系统的核心用户实体。

**字段说明：**
- `id`：主键，自增整数
- `username`：用户名，唯一，用于登录
- `password`：密码，加密存储
- `icon`：头像，存储头像文件路径
- `email`：邮箱地址，可选
- `nick_name`：昵称，显示名称
- `note`：备注信息，可选
- `status`：状态，1=启用，0=禁用
- `created_at`：创建时间
- `updated_at`：更新时间

**索引设计：**
- 主键索引：`id`
- 唯一索引：`username`
- 普通索引：`email`、`status`

#### 3.2.2 角色表（roles）
存储角色信息，用于权限分组管理。

**字段说明：**
- `id`：主键，自增整数
- `name`：角色名称，唯一
- `description`：角色描述
- `admin_count`：该角色下的用户数量
- `status`：状态，1=启用，0=禁用
- `sort`：排序字段
- `created_at`：创建时间
- `updated_at`：更新时间

**索引设计：**
- 主键索引：`id`
- 唯一索引：`name`
- 普通索引：`status`、`sort`

#### 3.2.3 菜单表（menus）
存储系统菜单信息，支持多级菜单结构。

**字段说明：**
- `id`：主键，自增整数
- `parent_id`：父级菜单ID，0表示顶级菜单
- `title`：菜单标题
- `level`：菜单层级，1=一级菜单，2=二级菜单
- `sort`：排序字段
- `name`：前端路由名称
- `icon`：菜单图标
- `hidden`：是否隐藏，1=隐藏，0=显示
- `keep_alive`：是否缓存页面，1=缓存，0=不缓存
- `created_at`：创建时间
- `updated_at`：更新时间

**索引设计：**
- 主键索引：`id`
- 普通索引：`parent_id`、`level`、`sort`、`hidden`

#### 3.2.4 资源表（resources）
存储API资源信息，用于接口权限控制。

**字段说明：**
- `id`：主键，自增整数
- `category_id`：资源分类ID，外键关联resource_categories表
- `name`：资源名称，如"用户列表"
- `route_name`：路由名称，如"users.index"，支持通配符
- `description`：资源描述
- `created_at`：创建时间
- `updated_at`：更新时间

**索引设计：**
- 主键索引：`id`
- 普通索引：`category_id`、`route_name`

#### 3.2.5 资源分类表（resource_categories）
存储资源分类信息，便于资源管理和分配。

**字段说明：**
- `id`：主键，自增整数
- `name`：分类名称
- `sort`：排序字段
- `created_at`：创建时间
- `updated_at`：更新时间

**索引设计：**
- 主键索引：`id`
- 普通索引：`sort`

#### 3.2.6 操作日志表（admin_operation_logs）
记录用户操作日志，用于审计和追踪。

**字段说明：**
- `id`：主键，自增整数
- `admin_id`：操作用户ID，外键关联admins表
- `operation`：操作类型，如"login"、"create_user"
- `detail`：操作详情，JSON格式存储
- `ip`：操作IP地址
- `address`：IP地址归属地
- `user_agent`：浏览器/客户端信息
- `created_at`：操作时间
- `updated_at`：更新时间

**索引设计：**
- 主键索引：`id`
- 普通索引：`admin_id`、`operation`、`created_at`

#### 3.2.7 关联表设计

**用户-角色关联表（admin_role）**
- `id`：主键，自增整数
- `admin_id`：用户ID，外键关联admins表
- `role_id`：角色ID，外键关联roles表
- `created_at`：创建时间
- `updated_at`：更新时间

**角色-菜单关联表（role_menu）**
- `id`：主键，自增整数
- `role_id`：角色ID，外键关联roles表
- `menu_id`：菜单ID，外键关联menus表
- `created_at`：创建时间
- `updated_at`：更新时间

**角色-资源关联表（role_resource）**
- `id`：主键，自增整数
- `role_id`：角色ID，外键关联roles表
- `resource_id`：资源ID，外键关联resources表
- `created_at`：创建时间
- `updated_at`：更新时间

### 3.3 数据关系设计

#### 3.3.1 一对多关系
- 资源分类 → 资源：一个分类可以有多个资源
- 用户 → 操作日志：一个用户可以有多个操作日志

#### 3.3.2 多对多关系
- 用户 ↔ 角色：通过admin_role表关联
- 角色 ↔ 菜单：通过role_menu表关联
- 角色 ↔ 资源：通过role_resource表关联

#### 3.3.3 自关联关系
- 菜单表自关联：通过parent_id字段实现多级菜单

---

## 四、权限管理设计

### 4.1 权限模型设计

#### 4.1.1 RBAC 权限模型
```
┌─────────────────────────────────────────────────────────────┐
│                        RBAC 权限模型                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  用户 (User)          角色 (Role)          权限 (Permission) │
│  ┌─────────┐         ┌─────────┐         ┌─────────────┐   │
│  │ 用户A   │◄────────┤ 角色A   │◄────────┤ 菜单权限    │   │
│  │ 用户B   │         │ 角色B   │         │ 资源权限    │   │
│  │ 用户C   │         │ 角色C   │         │ 操作权限    │   │
│  └─────────┘         └─────────┘         └─────────────┘   │
│       │                   │                   │            │
│       └───────────────────┼───────────────────┘            │
│                           │                                │
│                    ┌─────────────┐                        │
│                    │ 权限分配    │                        │
│                    │ (Assignment)│                        │
│                    └─────────────┘                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 4.1.2 权限层次结构
```
┌─────────────────────────────────────────────────────────────┐
│                        权限层次结构                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  系统级权限 (System Level)                                  │
│  ├── 用户管理权限                                           │
│  │   ├── 用户查看 (users.index)                            │
│  │   ├── 用户创建 (users.create)                           │
│  │   ├── 用户编辑 (users.edit)                             │
│  │   └── 用户删除 (users.delete)                           │
│  │                                                         │
│  ├── 角色管理权限                                           │
│  │   ├── 角色查看 (roles.index)                            │
│  │   ├── 角色创建 (roles.create)                           │
│  │   ├── 角色编辑 (roles.edit)                             │
│  │   └── 角色删除 (roles.delete)                           │
│  │                                                         │
│  ├── 菜单管理权限                                           │
│  │   ├── 菜单查看 (menus.index)                            │
│  │   ├── 菜单创建 (menus.create)                           │
│  │   ├── 菜单编辑 (menus.edit)                             │
│  │   └── 菜单删除 (menus.delete)                           │
│  │                                                         │
│  └── 资源管理权限                                           │
│      ├── 资源查看 (resources.index)                        │
│      ├── 资源创建 (resources.create)                       │
│      ├── 资源编辑 (resources.edit)                         │
│      └── 资源删除 (resources.delete)                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 权限控制机制

#### 4.2.1 前端权限控制
```
┌─────────────────────────────────────────────────────────────┐
│                        前端权限控制                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  路由权限控制                                               │
│  ├── 动态路由生成：根据用户菜单权限生成可访问路由            │
│  ├── 路由守卫：检查用户是否有访问该路由的权限               │
│  └── 404重定向：未授权路由重定向到404页面                   │
│                                                             │
│  菜单权限控制                                               │
│  ├── 菜单渲染：根据用户菜单权限动态渲染侧边栏菜单            │
│  ├── 菜单隐藏：未授权菜单不显示                             │
│  └── 菜单排序：根据菜单sort字段进行排序                     │
│                                                             │
│  按钮权限控制                                               │
│  ├── 权限指令：v-permission指令控制按钮显示                 │
│  ├── 权限验证：检查用户是否有操作权限                       │
│  └── 权限隐藏：未授权按钮自动隐藏                           │
│                                                             │
│  页面缓存控制                                               │
│  ├── 缓存策略：根据菜单keep_alive字段决定是否缓存           │
│  ├── 缓存管理：支持手动刷新和清除缓存                       │
│  └── 缓存优化：提升页面访问性能                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 4.2.2 后端权限控制
```
┌─────────────────────────────────────────────────────────────┐
│                        后端权限控制                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  认证中间件 (Authentication Middleware)                     │
│  ├── Token验证：验证JWT Token的有效性                       │
│  ├── 用户获取：从Token中获取用户信息                        │
│  └── 认证失败：返回401未授权错误                            │
│                                                             │
│  权限中间件 (Permission Middleware)                         │
│  ├── 路由名称获取：获取当前请求的路由名称                   │
│  ├── 权限检查：检查用户是否有访问该路由的权限               │
│  ├── 通配符匹配：支持通配符权限匹配（如users.*）            │
│  └── 权限失败：返回403权限不足错误                          │
│                                                             │
│  日志中间件 (Log Middleware)                                │
│  ├── 操作记录：记录用户的所有操作                           │
│  ├── 日志详情：记录请求参数、响应结果、操作时间等            │
│  └── 日志存储：将日志存储到数据库                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 权限分配流程

#### 4.3.1 权限分配流程图
```
┌─────────────────────────────────────────────────────────────┐
│                        权限分配流程                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 创建资源 (Create Resources)                            │
│     ├── 定义API资源                                         │
│     ├── 设置资源分类                                        │
│     └── 配置路由名称                                        │
│                                                             │
│  2. 创建菜单 (Create Menus)                                │
│     ├── 定义菜单结构                                        │
│     ├── 设置菜单权限                                        │
│     └── 配置菜单属性                                        │
│                                                             │
│  3. 创建角色 (Create Roles)                                │
│     ├── 定义角色信息                                        │
│     ├── 分配菜单权限                                        │
│     └── 分配资源权限                                        │
│                                                             │
│  4. 创建用户 (Create Users)                                │
│     ├── 创建用户账号                                        │
│     ├── 分配用户角色                                        │
│     └── 设置用户状态                                        │
│                                                             │
│  5. 权限生效 (Permission Active)                           │
│     ├── 用户登录                                            │
│     ├── 权限计算                                            │
│     └── 权限应用                                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 4.3.2 权限计算逻辑
```
┌─────────────────────────────────────────────────────────────┐
│                        权限计算逻辑                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  用户登录后权限计算流程：                                    │
│                                                             │
│  1. 获取用户信息                                            │
│     ├── 从Token中获取用户ID                                 │
│     ├── 查询用户基本信息                                    │
│     └── 检查用户状态                                        │
│                                                             │
│  2. 获取用户角色                                            │
│     ├── 查询用户关联的角色                                  │
│     ├── 过滤启用的角色                                      │
│     └── 获取角色列表                                        │
│                                                             │
│  3. 计算菜单权限                                            │
│     ├── 获取所有角色关联的菜单                              │
│     ├── 去重和排序                                          │
│     └── 构建菜单树结构                                      │
│                                                             │
│  4. 计算资源权限                                            │
│     ├── 获取所有角色关联的资源                              │
│     ├── 去重和分类                                          │
│     └── 构建权限列表                                        │
│                                                             │
│  5. 返回权限数据                                            │
│     ├── 菜单权限数据                                        │
│     ├── 资源权限数据                                        │
│     └── 用户基本信息                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 五、前端布局设计

### 5.1 整体布局结构
```
┌─────────────────────────────────────────────────────────────┐
│                        前端布局设计                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                    顶部导航栏                            │ │
│  │  ┌─────────┐ ┌─────────────────┐ ┌─────────────────┐   │ │
│  │  │ 折叠按钮 │ │   面包屑导航     │ │ 全屏 大小 头像   │   │ │
│  │  └─────────┘ └─────────────────┘ └─────────────────┘   │ │
│  └─────────────────────────────────────────────────────────┘ │
│  ┌─────────┐ ┌─────────────────────────────────────────────┐ │
│  │         │ │             标签栏导航                        │ │
│  │         │ │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐           │ │
│  │         │ │  │首页 │ │用户 │ │角色 │ │菜单 │           │ │
│  │         │ │  └─────┘ └─────┘ └─────┘ └─────┘           │ │
│  │         │ └─────────────────────────────────────────────┘ │
│  │         │ ┌─────────────────────────────────────────────┐ │
│  │         │ │                                             │ │
│  │         │ │             主内容区                          │ │
│  │         │ │                                             │ │
│  │         │ │                                             │ │
│  │         │ │                                             │ │
│  │         │ │                                             │ │
│  │         │ │                                             │ │
│  │         │ │                                             │ │
│  │         │ └─────────────────────────────────────────────┘ │
│  │         │ ┌─────────────────────────────────────────────┐ │
│  │         │ │                底部版权信息                   │ │
│  │         │ │   © 2024 Your Company. All Rights Reserved. │ │
│  │         │ └─────────────────────────────────────────────┘ │
│  └─────────┴───────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

#### 5.2 主要功能区说明

- **顶部导航栏**：包含系统Logo、菜单折叠按钮、面包屑导航、全屏按钮、布局大小切换、个人头像及下拉菜单（个人中心、退出登录）。
- **侧边栏**：根据用户权限动态渲染，支持多级菜单、图标、排序、隐藏等功能。
- **标签栏导航**：展示已访问页面的标签，支持关闭、刷新、右键菜单，结合菜单的缓存设置决定页面是否缓存。
- **主内容区**：根据路由动态渲染页面内容，支持页面缓存和刷新。
- **底部版权信息**：全局固定，显示公司版权、系统版本等信息。

---

## 六、OpenAPI 文档支持

- **后端**：所有 API 接口需使用 OpenAPI 3.0 注解，自动生成接口文档，支持在线预览和测试。
- **前端**：集成 Swagger UI，提供独立的“API文档”页面，便于开发和对接。
- **文档维护**：每次接口变更需同步更新注解，保证文档与实现一致。

---

## 七、开发规范

### 7.1 代码结构规范

- **后端**：严格分层（控制器、服务、仓储、模型），控制器无业务逻辑，所有业务处理在服务层完成。
- **前端**：页面、组件、API、状态管理、工具函数分目录管理，组件命名统一 PascalCase，文件命名统一 kebab-case。

### 7.2 命名规范

- **数据库表**：统一小写+下划线，如 admin_operation_logs。
- **字段名**：统一小写+下划线，如 created_at、updated_at。
- **变量/方法**：后端 camelCase，前端 camelCase。
- **常量**：全大写+下划线，如 API_VERSION。

### 7.3 注释与文档

- 关键业务、复杂逻辑必须有中文注释。
- 所有 API 必须有 OpenAPI 注解，描述参数、响应、错误码。
- 重要方法、类需有注释说明用途和用法。

### 7.4 代码风格

- **后端**：遵循 PSR-12 规范，使用 PHP-CS-Fixer 自动格式化。
- **前端**：使用 ESLint + Prettier，统一代码风格，提交前自动检查。
- **提交信息**：采用 Conventional Commits 规范，如 feat: 新增用户管理接口。

### 7.5 安全规范

- 所有输入参数必须验证和过滤，防止 SQL 注入、XSS 等安全问题。
- 认证接口需防止暴力破解，敏感操作需记录操作日志。
- Token、密码等敏感信息严禁明文存储和输出。

### 7.6 测试规范

- 后端需编写单元测试和接口测试，覆盖率不低于 80%。
- 前端需编写组件测试和页面测试，关键流程需有自动化测试。
- 所有新功能需先通过测试再上线。

### 7.7 部署与运维

- 生产环境需关闭 debug，开启日志和异常监控。
- 数据库、缓存、API 文档等需定期备份。
- 代码上线需走 CI/CD 流程，自动化测试通过后方可部署。

---

## 八、其他说明

- **多环境支持**：开发、测试、生产环境配置分离，敏感信息通过环境变量管理。
- **扩展性**：系统设计需考虑后续业务扩展，接口、权限、菜单等均支持动态配置。
- **团队协作**：代码合并需走 Pull Request 流程，至少一人 Code Review。
